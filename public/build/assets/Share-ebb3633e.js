import{l as p,Z as u,j as f,x as h,O as g,p as _,o as r,f as i,b as o,F as w,q as x,t as m,G as v,a as k}from"./app-f393c158.js";import C from"./PromptForm-1c247068.js";import T from"./ChatMessage-1f167186.js";import{_ as S}from"./AuthenticatedLayout-2093e66c.js";import y from"./ChatList-75c3722d.js";import{_ as b}from"./_plugin-vue_export-helper-c27b6911.js";const L=p({props:{user:Object,chats:Array,sessions:Array,sessionId:{required:!0,type:String}},components:{Head:u,Link:f,AuthenticatedLayout:S,PromptForm:C,ChatMessage:T,ChatList:y},data(){return{prompt:"",data:[],messages:[],charsPerToken:4,tokenCostPerThousand:.005,isUserScrollBottom:!0,channel:null,channelTeam:null,users:{}}},unmounted(){window.Echo.leave(`chat.${this.sessionId}`)},mounted(){window.chat=this,this.messages=this.chats,h(()=>{this.$refs.chatWindow.scrollTo(0,this.$refs.chatWindow.scrollHeight)})},computed:{messageCosts(){let t="";return this.messages.map(e=>{t+=e.content;let s=t.length;e.role=="assistant"&&(s=e.content.length);const n=s/this.charsPerToken,a=n/1e3*this.tokenCostPerThousand,d=e.content.length/this.charsPerToken,l=e.content.length;return{role:e.role,length:s,messageLength:l,tokens:n,cost:a,mesageTokens:d}})},total(){const e=this.messageCosts.reduce((n,a)=>n+a.length,0)/this.charsPerToken,s=e/1e3*this.tokenCostPerThousand;return{tokens:e,cost:s.toFixed(4)}},totalTokens(){return this.messages.reduce((t,e)=>typeof e.total_tokens=="number"?t+e.total_tokens:t,0)},totalCost(){return(this.totalTokens/1e3*this.tokenCostPerThousand).toFixed(4)}},methods:{go(t){g.visit(t)},addChatChunk(t,e){this.addMessage(t,e),h(()=>{this.scrollToBottom()})},addMessage(t,e){const s=this.messages.findIndex(n=>n.id===t.id);s===-1?this.messages.push(t):this.messages[s].content=(this.messages[s].content??"")+(e.delta.content??"")},handleScroll(){console.log("USER SCROLL");let t=this.$refs.chatWindow;this.isUserScrollBottom=t.scrollTop+t.clientHeight>=t.scrollHeight-100},scrollToBottom(){this.isUserScrollBottom&&this.$refs.chatWindow.scrollTo(0,this.$refs.chatWindow.scrollHeight)},send:async function(t){const e=t.prompt,s=await axios.post(route("api.chatStart"),{sessionId:this.sessionId,prompt:e});s.status!=200&&alert("error!"),console.log(s.data,"response.data"),s.data.sessionId!==this.sessionId&&alert("session ids do not match!?"),s.data.chat,h(()=>{this.$refs.chatWindow.scrollTo(0,this.$refs.chatWindow.scrollHeight)}),this.prompt="",this.streamResponse(this.sessionId)},streamResponse(t){try{const e=new EventSource(route("api.chatStream",t),{withCredentials:!0});e.addEventListener("stop",s=>{e.close()}),e.addEventListener("error",s=>{console.error("EventSource failed:",s)})}catch(e){console.error("There was a problem with the streaming operation:",e)}}}});const $={class:"absolute inset-0 flex flex-col"},I=v('<div class="font-semibold text-xl text-gray-800 leading-tight text-center p-2"><a href="https://ai.newicon.net"><svg class="inline-flex" width="22" height="25" viewBox="0 0 22 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.45769 24.2342V9.5455L16.9231 24.2342H20.7335V20.4352L4.7756 0H0V24.2342H5.45769Z" fill="black"></path><path d="M16 5.42352L21.4235 5.42352V2.90871e-05L16 2.90871e-05V5.42352Z" fill="black"></path></svg></a></div>',1),H={class:"flex h-full"},P={class:"@container h-full grow flex flex-col bg-white dark:bg-black"},B={class:"grow flex relative"},W={class:"px-4 py-8 flex flex-col flex-1 text-base mx-auto gap-5 @md:max-w-3xl @lg:max-w-[40rem] @xl:max-w-[48rem] group final-completion"},V={key:0},E=o("div",{class:"flex"},[o("div",{class:"h-8 w-8 min-w-8 mr-2 rounded-full flex items-center justify-center bg-black text-white"},"AI"),o("div",null,[o("div",{class:"mt-1 font-semibold"},"ChatGPT"),o("div",{class:"prose"},"How can I help you today?")])],-1),M=[E],F={class:"text-center"},A={class:"text-xs"};function O(t,e,s,n,a,d){const l=_("ChatMessage");return r(),i("div",$,[I,o("div",H,[o("div",P,[o("div",B,[o("div",{ref:"chatWindow",class:"absolute inset-0 overflow-y-scroll",onScroll:e[0]||(e[0]=(...c)=>t.handleScroll&&t.handleScroll(...c))},[o("div",W,[t.messages.length==0?(r(),i("div",V,M)):(r(!0),i(w,{key:1},x(t.messages,(c,R)=>(r(),i("div",null,[k(l,{message:c},null,8,["message"])]))),256)),o("div",F,[o("code",A,"tokens: "+m(t.totalTokens)+" | cost: "+m(t.totalCost),1)])])],544)])])])])}const D=b(L,[["render",O]]);export{D as default};
