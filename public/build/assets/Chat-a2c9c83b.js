import{_ as C}from"./AuthenticatedLayout-5d316374.js";import{l as x,p as c,o as i,f as l,a as h,w as u,F as p,Z as S,j as y,b as t,q as f,t as k}from"./app-141596ac.js";import b from"./PromptForm-d55fdeee.js";import E from"./ChatMessage-b7a13b9f.js";import L from"./ChatList-116f8cc4.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";const $=x({props:{user:Object,chats:Array,sessions:Array},components:{AuthenticatedLayout:C,Head:S,Link:y,PromptForm:b,ChatMessage:E,ChatList:L},data(){return{prompt:"",sessionId:void 0,data:[],messages:[],charsPerToken:4,tokenCostPerThousand:.01,isUserScrollBottom:!0}},mounted(){window.chat=this,this.chats.forEach(e=>{this.messages.push({role:e.role,content:e.content,state:"finished"})}),window.Echo.join("team").listen(".ChatSessionCreated",e=>{console.log("EVENT",e)}).listen(".ChatSessionUpdated",e=>{console.log("EVENT",e)}).listen("ChatSessionCreated",e=>{console.log("ChatSession created:",e.chatSession)})},methods:{handleScroll(){let e=this.$refs.chatWindow;this.isUserScrollBottom=e.scrollTop+e.clientHeight>=e.scrollHeight-40},scrollToBottom(){let e=this.$refs.chatWindow;isUserAtBottom&&e.scrollTo(0,e.scrollHeight)},send:async function(e){const o=e.prompt,n=await axios.post(route("api.chatStart"),{sessionId:this.sessionId,prompt:o});n.status!=200&&alert("error!");const r=n.data.sessionId,a=n.data.chat;this.messages.push(a),this.prompt="",this.streamResponse(r,()=>{window.location.href=route("chat.session",r)})},streamResponse(e,o){try{let n={role:"assistant",content:"",state:"loading"};this.messages.push(n);let r=this.messages.indexOf(n);const a=new EventSource(route("api.chatStream",e),{withCredentials:!0});a.addEventListener("message",d=>{this.messages[r].state="streaming";const m=JSON.parse(d.data);m.delta.content&&(this.messages[r].content=n.content+m.delta.content,this.scrollToBottom())}),a.addEventListener("stop",d=>{a.close(),this.messages[r].state="finished",o()}),a.addEventListener("error",d=>{console.error("EventSource failed:",d),a.close()})}catch(n){console.error("There was a problem with the fetch operation:",n)}}}}),B=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Chat",-1),A=["value"],H={class:"flex h-full"},I={class:"@container h-full grow flex flex-col bg-white dark:bg-black"},P={class:"grow flex relative"},F={class:"px-4 py-8 flex flex-col flex-1 text-base mx-auto gap-5 @md:max-w-3xl @lg:max-w-[40rem] @xl:max-w-[48rem] group final-completion"},N={key:0},U=t("div",{class:"flex"},[t("div",{class:"h-8 w-8 min-w-8 mr-2 rounded-full flex items-center justify-center bg-black text-white"},"AI"),t("div",null,[t("div",{class:"mt-1 font-semibold text-black dark:text-white"},"ChatGPT"),t("div",{class:"prose dark:prose-invert"},"How can I help you today?")])],-1),W=[U],j={class:"px-4"};function V(e,o,n,r,a,d){const m=c("Head"),g=c("ChatList"),_=c("ChatMessage"),v=c("PromptForm"),w=c("AuthenticatedLayout");return i(),l(p,null,[h(m,{title:"Chat"}),h(w,null,{header:u(()=>[B,t("select",{class:"ml-3 block lg:hidden",onChange:o[0]||(o[0]=s=>e.$router.visit(e.$route("chat.session",s.target.value)))},[(i(!0),l(p,null,f(e.sessions,s=>(i(),l("option",{value:s.id,key:s.id},k(s.prompt.slice(0,25)),9,A))),128))],32)]),default:u(()=>[t("div",H,[h(g,{sessions:e.sessions},null,8,["sessions"]),t("div",I,[t("div",P,[t("div",{ref:"chatWindow",class:"absolute inset-0 overflow-y-scroll",onScroll:o[1]||(o[1]=(...s)=>e.handleScroll&&e.handleScroll(...s))},[t("div",F,[e.messages.length==0?(i(),l("div",N,W)):(i(!0),l(p,{key:1},f(e.messages,s=>(i(),l("div",null,[h(_,{message:s},null,8,["message"])]))),256))])],544)]),t("div",j,[h(v,{onSend:e.send,prompt:e.prompt,"onUpdate:prompt":o[2]||(o[2]=s=>e.prompt=s)},null,8,["onSend","prompt"])])])])]),_:1})],64)}const J=T($,[["render",V]]);export{J as default};
