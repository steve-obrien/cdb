import w from"./ChatLayout-47e93a00.js";import{l as _,p as c,o as d,f as m,a as h,w as v,F as p,Z as C,j as S,b as t,q as x}from"./app-1ca54d9f.js";import y from"./PromptForm-60f87093.js";import E from"./ChatMessage-3f92fbae.js";import{_ as k}from"./_plugin-vue_export-helper-c27b6911.js";import"./AuthenticatedLayout-ac63b1f4.js";const T=_({props:{user:Object,chats:Array,sessions:Array},components:{ChatLayout:w,Head:C,Link:S,PromptForm:y,ChatMessage:E},data(){return{prompt:"",sessionId:void 0,data:[],messages:[],charsPerToken:4,tokenCostPerThousand:.01,isUserScrollBottom:!0}},mounted(){window.chat=this,this.chats.forEach(e=>{this.messages.push({role:e.role,content:e.content,state:"finished"})}),window.Echo.join("team").listen(".ChatSessionCreated",e=>{console.log("EVENT",e)}).listen(".ChatSessionUpdated",e=>{console.log("EVENT",e)}).listen("ChatSessionCreated",e=>{console.log("ChatSession created:",e.chatSession)})},methods:{handleScroll(){let e=this.$refs.chatWindow;this.isUserScrollBottom=e.scrollTop+e.clientHeight>=e.scrollHeight-40},scrollToBottom(){let e=this.$refs.chatWindow;isUserAtBottom&&e.scrollTo(0,e.scrollHeight)},send:async function(e){const o=e.prompt,s=await axios.post(route("api.chatStart"),{sessionId:this.sessionId,prompt:o});s.status!=200&&alert("error!");const a=s.data.sessionId,n=s.data.chat;this.messages.push(n),this.prompt="",this.streamResponse(a,()=>{window.location.href=route("chat.session",a)})},streamResponse(e,o){try{let s={role:"assistant",content:"",state:"loading"};this.messages.push(s);let a=this.messages.indexOf(s);const n=new EventSource(route("api.chatStream",e),{withCredentials:!0});n.addEventListener("message",r=>{this.messages[a].state="streaming";const l=JSON.parse(r.data);l.delta.content&&(this.messages[a].content=s.content+l.delta.content,this.scrollToBottom())}),n.addEventListener("stop",r=>{n.close(),this.messages[a].state="finished",o()}),n.addEventListener("error",r=>{console.error("EventSource failed:",r.data),n.close()})}catch(s){console.error("There was a problem with the fetch operation:",s)}}}}),b={class:"grow flex relative"},B={class:"px-4 py-8 flex flex-col flex-1 text-base mx-auto gap-5 @md:max-w-3xl @lg:max-w-[40rem] @xl:max-w-[48rem] group final-completion"},L={key:0},H=t("div",{class:"flex"},[t("div",{class:"h-8 w-8 min-w-8 mr-2 rounded-full flex items-center justify-center bg-black text-white"},"AI"),t("div",null,[t("div",{class:"mt-1 font-semibold text-black dark:text-white"},"ChatGPT"),t("div",{class:"prose dark:prose-invert"},"How can I help you today?")])],-1),I=[H],P={class:"px-4"};function $(e,o,s,a,n,r){const l=c("Head"),u=c("ChatMessage"),f=c("PromptForm"),g=c("ChatLayout");return d(),m(p,null,[h(l,{title:"Chat"}),h(g,{sessions:e.sessions},{default:v(()=>[t("div",b,[t("div",{ref:"chatWindow",class:"absolute inset-0 overflow-y-scroll",onScroll:o[0]||(o[0]=(...i)=>e.handleScroll&&e.handleScroll(...i))},[t("div",B,[e.messages.length==0?(d(),m("div",L,I)):(d(!0),m(p,{key:1},x(e.messages,i=>(d(),m("div",null,[h(u,{message:i},null,8,["message"])]))),256))])],544)]),t("div",P,[h(f,{onSend:e.send,prompt:e.prompt,"onUpdate:prompt":o[1]||(o[1]=i=>e.prompt=i)},null,8,["onSend","prompt"])])]),_:1},8,["sessions"])],64)}const V=k(T,[["render",$]]);export{V as default};
